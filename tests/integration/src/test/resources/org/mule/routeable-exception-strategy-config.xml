<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.2"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:spring="http://www.springframework.org/schema/beans"
    xmlns:test="http://www.mulesource.org/schema/mule/test/2.2"
    xmlns:vm="http://www.mulesource.org/schema/mule/vm/2.2"
    xsi:schemaLocation="
               http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
               http://www.mulesource.org/schema/mule/core/2.2 http://www.mulesource.org/schema/mule/core/2.2/mule.xsd
               http://www.mulesource.org/schema/mule/vm/2.2 http://www.mulesource.org/schema/mule/vm/2.2/mule-vm.xsd
               http://www.mulesource.org/schema/mule/test/2.2 http://www.mulesource.org/schema/mule/test/2.2/mule-test.xsd">

    <vm:endpoint name="exception" path="exception"
        transformer-refs="duplicateTransformer" synchronous="true" />

    <spring:bean factory-bean="exception" factory-method="buildOutboundEndpoint" name="exceptionEndpoint"/>
    
    <vm:connector name="queue" queueEvents="true" />

    <custom-transformer name="duplicateTransformer"
        class="org.mule.DuplicateTransformer" />
    <custom-transformer name="failingIncTransformer"
        class="org.mule.IncButEvenFailingTransformer" />

    <model>
        <service name="TestSyncTransactionalErrorHandling">
            <inbound>
                <vm:inbound-endpoint name="in" path="in"
                    synchronous="true" transformer-refs="failingIncTransformer" />
            </inbound>
            <outbound>
                <pass-through-router>
                    <vm:outbound-endpoint name="out"
                        path="out" synchronous="true" />
                </pass-through-router>
            </outbound>
            <custom-exception-strategy
                class="org.mule.RouteableExceptionStrategy">
                <rollback-transaction
                    exception-pattern="*" />

                <spring:property name="router">
                    <spring:bean
    class="org.mule.routing.outbound.OutboundPassThroughRouter">
                        <spring:property name="endpoints">
                            <spring:list>
                                <spring:ref bean="exceptionEndpoint"/>
                            </spring:list>
                        </spring:property>
                    </spring:bean>
                </spring:property>
            </custom-exception-strategy>
        </service>
    </model>
</mule>